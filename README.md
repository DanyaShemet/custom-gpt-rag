# ๐ง GPT-RAG ะฑะพั ัะท ะฟัะดััะธะผะบะพั PDF + SessionId + S3 + Auto-Cleanup

ะฆะตะน ะฟัะพัะบั โ ะณะพัะพะฒะธะน ะดะพ ะดะตะฟะปะพั GPT-ะฑะฐะทะพะฒะฐะฝะธะน ัะฐั-ะฑะพั, ัะบะธะน:
- ะฟัะฐััั ััะปัะบะธ ะฝะฐ ะพัะฝะพะฒั ะปะพะบะฐะปัะฝะพั ะฑะฐะทะธ ะทะฝะฐะฝั
- ะดะพะทะฒะพะปัั ะทะฐะฒะฐะฝัะฐะถะธัะธ ะบัะปัะบะฐ PDF ะฒ ะผะตะถะฐั ะพะดะฝััั ัะตััั
- ะพัะธัะฐั ะฒัั ัะฐะนะปะธ ัะตัะตะท 24 ะณะพะดะธะฝะธ

## ๐ฆ ะขะตัะฝะพะปะพะณัั
- Node.js (Express)
- Python (OpenAI Embedding + Cosine Similarity)
- AWS S3 (ะดะปั PDF)
- Render (ัะพััะธะฝะณ)
- OpenAI API



```mermaid
graph TD
    A[๐ค ะะพัะธัััะฒะฐั ะฒัะดะบัะธะฒะฐั ัะฐะนั] --> B{SessionId ััะฝัั?}
B -- ะั --> C[ะะตะฝะตัััะผะพ ะฝะพะฒะธะน sessionId ัะฐ ะทะฑะตััะณะฐัะผะพ ะฒ localStorage]
B -- ะขะฐะบ --> D[ะะธะบะพัะธััะพะฒััะผะพ ััะฝัััะธะน sessionId]

D --> E[โฌ๏ธ ะะฐะฒะฐะฝัะฐะถะตะฝะฝั PDF ัะตัะตะท /upload]
C --> E

E --> F[๐พ ะะฑะตััะณะฐัะผะพ PDF ะฒ S3 pdfs/user_sessionId/...]
F --> G[๐ ะะธััะณััะผะพ ัะตะบัั ะท PDF]
G --> H[๐งฉ ะัะปะธะผะพ ะฝะฐ ััะฐะณะผะตะฝัะธ ะฟะพ 500 ัะธะผะฒ.]
H --> I[๐ ะะพะดะฐัะผะพ ะดะพ user_data/user_sessionId.json]

A --> J[โ ะะพัะธัััะฒะฐั ััะฐะฒะธัั ะฟะธัะฐะฝะฝั POST /api/chat]
J --> K[๐ Node ะทะฐะฟััะบะฐั retrieve.py ะท question + sessionId]
K --> L[๐ Python ัะธัะฐั user_data/user_sessionId.json]
L --> M[๐ก ะััะธะผัั embedding ะท OpenAI]
M --> N[๐ง ะะพััะบ ััะพะถะธั ััะฐะณะผะตะฝััะฒ cosine similarity]
N --> O[๐ฆ ะะพะฒะตัะฝะตะฝะฝั top-3 ััะฐะณะผะตะฝััะฒ ั Node]
O --> P[๐ค GPT ะณะตะฝะตััั ะฒัะดะฟะพะฒัะดั ะฝะฐ ะพัะฝะพะฒั ะบะพะฝัะตะบััั]
P --> Q[๐ค ะัะดะฟัะฐะฒะบะฐ ะฒัะดะฟะพะฒัะดั ะบะพัะธัััะฒะฐัั]

subgraph ะะฒัะพะพัะธััะบะฐ
R[๐งน ะะตัะตะฒััะบะฐ user_data/ ะบะพะถะฝั 60 ัะฒ]
R --> S[๐ ะะธะดะฐะปะตะฝะฝั json-ัะฐะนะปัะฒ >24 ะณะพะด]
T[๐ S3 lifecycle rule] --> U[๐ ะะฒัะพะฒะธะดะฐะปะตะฝะฝั PDF ัะตัะตะท 1 ะดะตะฝั]
end

```

